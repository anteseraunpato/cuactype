<title>Cuactype - Test your typing skills</title>
<style>
    :root {
    color-scheme: light dark;
    --greeen: #00b755;
    --yellow: #daaf38;
    --red: #ca4754;
    --black: #222;
    --gray: #999;
    }

    body {
        background: var(--black);
        font-family: monospace;
        display: grid;
        padding: 32px;
        justify-content: center;
        margin-top: 32px;
        padding: 16px;
    }
    
    section {
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        max-width: 500px;
    }

    time {
        color: var(--yellow);
    }

    input {
        z-index: -999;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
    }

    p {
        display: flex;
        flex-wrap: wrap;
        gap: 3px 8px;
        margin: 0;
    }

    v-letter {
        color: var(--gray);
        position: relative;

        &.active::before {
            content: "|";
            color: var(--yellow);
            /* font-size: 14px; */
            position: absolute;
            left: -65%;
            animation:  1s blink infinite ease-in-out;

        }

        &.correct {
            color: var(--greeen);
        }

        &.incorrect {
            color: var(--red);
        }


    }

    @keyframes blink {

        0%, 25% {
        opacity:1;
        }

        75% {
        opacity: 0;
    }

}

</style>


<body>
    <main>
        <section id="game">
            <time></time>
            <p></p>
            <input autofocus>
        </section>
    </main>
</body>

<script>

    //recuperamos el contenido de cada una de las etiquetas
    const $time = document.querySelector('time');
    const $paragraph = document.querySelector('p');
    const $input = document.querySelector('input');

    const INITIAL_TIME = 30;

    const TEXT = "el zorro marron rapida y velozmente salto sobre el agil perro que dormia junto al rio tranquilo y sereno bajo el cielo azul y despejado";

    let words = []
    let currentTime = INITIAL_TIME


    initGame()
    initEvents()

    //Creamos la funcion que inicia el juego
    function initGame() {
        //Utilizando el .split y el espacio transforma las palabras en el TEXT. Solamente toma las primeras 32 palabras.
        words = TEXT.split(' ').slice(0,32)
        //Inicializamos la variable currentTime con el valor de INITIAL_TIME cada que el juego se reinicia
        currentTime = INITIAL_TIME

        //Renderizamos el timer en la página
        $time.textContent = currentTime

        //Creamos el párrafo usando las palabras del array.

        $paragraph.innerHTML = words.map((word, index) => {

    //Creamos la constante letter y hacemos que esta divida cada palabra en las letras que la componen. Envolvemos cada palabra en la etiqueta word y cada letra en la etiqueta letter
            const letters = word.split('')

            return ` <v-word>
                ${letters
                .map(letter => `<v-letter>${letter}</v-letter>`)
                .join('')
                }
                </v-word>

            `
        }).join('')


        //Creamos la constante $firstWord que toma el primer elemento v-word y le agrega la clase active. Utilizando la misma constante obtenemos con querySelector el primer elemento letter y le agregamos la clase active. Esto nos servirá para el cursor
        const $firstWord = $paragraph.querySelector('v-word')
        $firstWord.classList.add('active')
        $firstWord.querySelector('v-letter').classList.add('active')

        //Creamos la variable que alojara el intervalo y le decimos que ajuste el valor del time cada 1 segundo
        const intervalID = setInterval(() => {
            currentTime--
            $time.textContent=currentTime
        //Creamos un if que imprime un mensaje en la consola cuando el currentTime es igual a 0
            if (currentTime === 0) {
                clearInterval(intervalID)
                gameOver()
            }
        },1000)

    }

    //Creamos las funciones para cada uno de los eventos
    function initEvents() { 

        //Hacemos que al comenzar a escribir la página el input reciba el focus
        document.addEventListener('keydown', () => {
            $input.focus()
        }
    )
    //Creamos las funciones que serán llamadas dependiendo si el usuario presiona o suelta una tecla
    $input.addEventListener('keydown', onKeyDown)
    $input.addEventListener('keyup', onKeyUp)

    }

    function onKeyDown() {}
    function onKeyUp(){
        //Recuperamos los elementos actuales
        const $currentWord = $paragraph.querySelector('v-word.active')
        const $currentLetter = $currentWord.querySelector('v-letter.active')

        const currentWord = $currentWord.innerText.trim()
        $input.maxLength = currentWord.length
        console.log({value: $input.value, currentWord})

        //Creamos una constante para obtener todas las letter de la palabra actual 
        const $allLetters = $currentWord.querySelectorAll('v-letter')

        //Limpiamos la clase correct e incorrect de cada letra
        $allLetters.forEach($letter => $letter.classList.remove('correct', 'incorrect'))

        //Recuperamos el valor del input y usando split convertimos cada letter en un array para poder comparar cada letra en la posición seleccionada con la letter que se encuentra en el index
        $input.value.split('').forEach((char, index) => {
            const $letter = $allLetters[index]
            const letterToCheck = currentWord[index]
        
            //Comparamos la letra en nuestro input y la letra activa de la palabra activa y si son iguales agregamos la classe correct, sino agregamos la clase incorrect
            const isCorrect = char === letterToCheck
            const letterClass = isCorrect ? 'correct' : 'incorrect' 
            $letter.classList.add(letterClass)
            
        })


    }

    function gameOver () {
        console.log('findeljuego')
    }

</script>